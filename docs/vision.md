# Vision Deck

`vision.md` агрегирует проработанные идеи из `idea.md` и описывает целевые решения на уровне концепций. Именно здесь фиксируется «как должно работать» до детализации задач.

## Структура
- **Инициатива / кодовое имя** — отсылка к записи в `idea.md` или эпикам BACKLOG.
- **Цель** — какую пользовательскую или операционную проблему решаем.
- **Ключевые сценарии** — пользовательские флоу, которые должны поддерживаться.
- **Технический подход** — основные решения по архитектуре, данным, API, UI.
- **Ограничения и риски** — технические, продуктовые, организационные.
- **Критерии успеха** — метрики, инварианты, признаки завершённости.

## Активные инициативы

### Modular Navigation (E17)
- **Цель** — сократить когнитивную нагрузку от длинного списка страниц и ускорить доступ к связанным инструментам.
- **Ключевые сценарии**
  1. Пользователь группирует страницы в одноуровневые секции и скрывает второстепенные пункты, не теряя возможность восстановить их через редактор.
  2. Внутри выбранного модуля пользователь переключается между связанными страницами через верхние вкладки, не покидая контекста.
  3. На любой странице пользователь отмечает её звёздочкой, чтобы добавить в персональное избранное и мгновенно добраться до неё из левого меню.
- **Технический подход**
  - Расширить `NAV_BLUEPRINT` полями `module`, `section_order`, `category`, обновить `build_navigation_payload` и API `/api/v1/navigation/sidebar*`.
  - Перестроить `AppShell` и `SidebarEditor`: секции с заголовками, collapsible, drag-n-drop внутри секции; левое меню — единый список избранных страниц, которые можно скрывать или раскрывать без дублирования; состояние хранится в `user_settings.nav_sidebar`.
  - Добавить компонент `FavoriteToggle` в AppShell header, синхронизирующийся с `user_settings.nav_sidebar` без отдельного списка избранного.
  - Верхнее меню модулей — новый компонент `ModuleTabs`, получает конфигурацию из `NAV_BLUEPRINT` и данных страницы.
  - Тесты: модульные (navigation_service), UI-снепшоты SidebarEditor/AppShell, e2e-проверка добавления избранного.
- **Ограничения и риски**
  - Необходимо сохранить обратную совместимость для пользователей без новых настроек (fallback к плоскому списку).
  - Усложнение состояния навигации требует аккуратной синхронизации между глобальными и пользовательскими пресетами.
  - Требуется сохранить поведение «один пункт — одна страница»: звёздочка только управляет видимостью, без создания копий в меню.
- **Критерии успеха**
  - Пользователь может создать кастомную секцию, скрыть пункт и восстановить его из редактора без перезагрузки.
  - Звёздочка на странице включает/выключает видимость пункта в левом меню и отображается заполненной при активном состоянии.
  - Верхние вкладки модулей корректно отображаются на мобильных устройствах (<= 400 px) и десктопах (>= 1440 px).
  - Документация в `docs/conventions.md`, `docs/tasklist.md`, `docs/CHANGELOG.md` обновлена, тесты проходят.


### CRM Knowledge Hub (E18)
- **Цель** — построить собственную CRM, в которой сделки и участники жёстко связаны с PARA-контекстом и дополняются знаниями (заметки, решения, ретроспективы) по принципам Zettelkasten.
- **Ключевые сценарии**
  1. Руководитель продаж управляет цифровой воронкой, видит лиды по стадиям, конверсию и автоматизации (ориентир — amoCRM Digital Pipeline).
  2. Куратор Telegram-группы открывает карточку участника, видит покупки, статус обучения и историю общения из единого контакт-центра (ориентир — Bitrix24 CRM).
  3. Команда принимает решения быстрее, потому что карточка сделки показывает связанные заметки, решения и бэклинки (Zettelkasten-слой знаний).
- **Технический подход**
  - Модели `crm_accounts`, `crm_deals`, `crm_touchpoints` наследуют PARA (`area_id`/`project_id`) и синхронизируются через `init_app_once`.
  - Next.js-модуль `/crm` с канбан-доской, виджетами карточек и панелью знаний; переиспользуем React Query, AppShell и компонент `TermHint` для терминов.
  - Контакт-центр агрегирует email/chat/voice-транзакции: единый таймлайн, быстрые действия «ответить из CRM», статусы операторов.
  - Автоматизации описываются в DSL поверх `core/services` (триггеры по стадии, оплате, активности), с фичефлагами для поэтапного rollout.
  - Каждая заметка или решение хранит обратные ссылки (`backlinks`) на сделки и контакты, чтобы сохранить Zettelkasten-связность.
- **Ограничения и риски**
  - Высокая сложность автоматизаций требует фичефлагов и постепенной включаемости.
  - Интеграции с Telegram и платёжными системами могут увеличить время отклика; нужны очереди и idempotency.
  - UI может перегрузиться от данных — требуется модульность и progressive disclosure.
- **Критерии успеха**
  - Сделки, контакты и группы отображаются в PARA-обзорах без ручной синхронизации.
  - Канбан показывает стадии, конверсию и прогноз выручки, поддерживает drag-n-drop и запуск автоматизаций.
  - Контакт-центр объединяет входящие сообщения, звонки и ответы операторов в едином таймлайне.
  - Панель знаний в карточке сделки демонстрирует связанные заметки, решения и бэклинки; доступны быстрые действия для создания заметок/задач.
  - Документация в `docs/conventions.md` и `docs/CHANGELOG.md` отражает UX-паттерны, правила данных и эволюцию CRM.

{% extends "base.html" %}
{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', path='css/notes.css') }}">
{% endblock %}

{% block content %}
<section class="page">

  <!-- Быстрая заметка -->
  <form id="quick-note" class="c-card collapsed">
    <input type="text" name="title" placeholder="Заметка..." aria-label="Заметка">
    <textarea name="content" rows="1" placeholder="Текст"></textarea>
    <div class="c-card__bottom qn-extra">
      <div class="chips">
        <select name="area_id" aria-label="Область"></select>
        <select name="project_id" aria-label="Проект (опционально)">
          <option value="">Без проекта</option>
        </select>
      </div>
      <div class="qn-actions">
        <button type="button" class="ui-iconbtn js-qn-pin" aria-label="Закрепить" data-tooltip="Закрепить"><svg><use href="#i-pin"/></svg></button>
        <button class="ui-iconbtn" type="submit" data-tooltip="Сохранить" aria-label="Сохранить">
          <svg><use href="#i-check"/></svg>
        </button>
      </div>
    </div>
  </form>

  <!-- Сетка карточек -->
  <div id="notesGrid" class="notes-grid cards-grid" aria-live="polite">
    {% for n in notes %}
    <article class="c-card note-card" style="--note-bg: {{ n.area.color or '#F3F4F6' }}" data-note-id="{{n.id}}" data-area-id="{{ n.area.id }}" data-project-id="{{ n.project.id if n.project else '' }}" data-pinned="{{ 1 if n.pinned else 0 }}">
      <div class="c-card__top">
        <button type="button" class="ui-iconbtn js-pin{% if n.pinned %} is-active{% endif %}" aria-label="{{ 'Открепить' if n.pinned else 'Закрепить' }}" data-tooltip="{{ 'Открепить' if n.pinned else 'Закрепить' }}">
          <svg><use href="#i-pin"/></svg>
        </button>
        <button type="button" class="ui-iconbtn ui-iconbtn--danger js-del" aria-label="Удалить" data-tooltip="Удалить">
          <svg><use href="#i-trash"/></svg>
        </button>
      </div>

      <div class="c-card__content">{{ n.content }}</div>

      <div class="c-card__bottom">
        <div class="chips">
          <span class="chip chip--area" title="Область">{{ n.area.name }}</span>
          {% if n.project %}<span class="chip chip--project" title="Проект">{{ n.project.name }}</span>{% endif %}
        </div>
        <div class="card-actions">
          <button type="button" class="ui-iconbtn js-share" aria-label="Поделиться" data-tooltip="Поделиться"><svg><use href="#i-share"/></svg></button>
          <button type="button" class="ui-iconbtn js-edit" aria-label="Редактировать" data-tooltip="Редактировать">
            <svg><use href="#i-edit"/></svg>
          </button>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>
  <dialog id="noteDialog"></dialog>
  <dialog id="areaDialog" class="c-card">
    <form id="areaForm" method="dialog">
      <div class="chips">
        <select name="area_id" aria-label="Область"></select>
        <select name="project_id" aria-label="Проект">
          <option value="">Без проекта</option>
        </select>
      </div>
      <div class="c-card__bottom">
        <button class="ui-iconbtn" value="cancel" aria-label="Отмена" data-tooltip="Отмена"><svg><use href="#i-x"/></svg></button>
        <button class="ui-iconbtn" value="save" aria-label="Сохранить" data-tooltip="Сохранить"><svg><use href="#i-check"/></svg></button>
      </div>
    </form>
  </dialog>
</section>
{% endblock %}

{% block scripts %}
  <script type="module" src="/static/js/ui/confirm.js"></script>
  <script type="module" src="/static/js/notes.js"></script>
{% endblock %}

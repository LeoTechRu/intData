{% extends "base.html" %}
{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', path='css/notes.css') }}">
{% endblock %}

{% block content %}
<section class="page">

  <!-- Быстрая заметка -->
  <form id="quick-note" class="c-card collapsed">
    <input type="text" name="title" placeholder="Заметка..." aria-label="Заметка">
    <textarea name="content" rows="1" placeholder="Текст"></textarea>
    <div class="c-card__bottom qn-extra">
      <div class="chips">
        <select name="area_id" aria-label="Область"></select>
        <select name="project_id" aria-label="Проект (опционально)">
          <option value="">Без проекта</option>
        </select>
      </div>
      <div class="qn-actions">
        <button type="button" class="ui-iconbtn js-qn-pin" aria-label="Закрепить" data-tooltip="Закрепить"><svg class="icon"><use href="/static/img/ui/icons.svg#pin"/></svg></button>
        <button class="ui-iconbtn" type="submit" data-tooltip="Сохранить" aria-label="Сохранить">
          <svg class="icon"><use href="/static/img/ui/icons.svg#save"/></svg>
        </button>
      </div>
    </div>
  </form>

  <!-- Сетка карточек -->
  <div id="notesGrid" class="notes-grid" aria-live="polite">
    {% for n in notes %}
    <article class="c-card note-card {% if n.area.color %}note--{{ n.area.color }}{% endif %}" data-note-id="{{n.id}}" data-area-id="{{ n.area.id }}" data-project-id="{{ n.project.id if n.project else '' }}" data-pinned="{{ 1 if n.pinned else 0 }}" data-title="{{ n.title or '' }}" data-content="{{ n.content }}">
      <button type="button" class="icon-btn note-card__pin js-pin{% if n.pinned %} is-active{% endif %}" aria-label="{{ 'Открепить' if n.pinned else 'Закрепить' }}" data-tooltip="{{ 'Открепить' if n.pinned else 'Закрепить' }}">
        <svg class="icon"><use href="/static/img/ui/icons.svg#pin"/></svg>
      </button>
      <div class="note-card__body">
        {% if n.title %}<div class="note-card__title">{{ n.title }}</div>{% endif %}
        <div class="note-card__text">{{ n.content }}</div>
      </div>
      <div class="note-card__footer">
        <div class="note-chip note-chip--area chip--area">{{ n.area.name }}</div>
        {% if n.project %}<div class="note-chip note-chip--project chip--project">{{ n.project.name }}</div>{% endif %}
        <div class="note-actions">
          <button type="button" class="icon-btn js-edit" aria-label="Редактировать" data-tooltip="Редактировать"><svg class="icon"><use href="/static/img/ui/icons.svg#edit"/></svg></button>
          <button type="button" class="icon-btn js-del" aria-label="Удалить" data-tooltip="Удалить"><svg class="icon"><use href="/static/img/ui/icons.svg#delete"/></svg></button>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>
  <dialog id="noteDialog" class="note-modal"></dialog>
  <dialog id="areaDialog" class="c-card">
    <form id="areaForm" method="dialog">
      <div class="chips">
        <select name="area_id" aria-label="Область"></select>
        <select name="project_id" aria-label="Проект">
          <option value="">Без проекта</option>
        </select>
      </div>
      <div class="c-card__bottom">
        <button class="ui-iconbtn" value="cancel" aria-label="Отмена" data-tooltip="Отмена"><svg class="icon"><use href="/static/img/ui/icons.svg#close"/></svg></button>
        <button class="ui-iconbtn" value="save" aria-label="Сохранить" data-tooltip="Сохранить"><svg class="icon"><use href="/static/img/ui/icons.svg#save"/></svg></button>
      </div>
    </form>
  </dialog>
</section>
{% endblock %}

{% block scripts %}
  <script type="module" src="/static/js/ui/confirm.js"></script>
  <script type="module" src="/static/js/notes.js"></script>
{% endblock %}

{% extends "base.html" %}
{% block title %}–î–∞—à–±–æ—Ä–¥{% endblock %}

{% block content %}
  <div class="has-dashboard">
    <div class="dashboard">

      {# ‚Äî –ü—Ä–æ—Ñ–∏–ª—å #}
      <section class="card span-2" id="card-profile">
        <div class="profile-info">
          <div class="profile-item"><span class="profile-icon" title="Full name">üë§</span><span>{{ profile_user.full_name or '‚Äî' }}</span></div>
          <div class="profile-item"><span class="profile-icon" title="Username">üîñ</span><span>{{ profile_user.username }}</span></div>
          <div class="profile-item"><span class="profile-icon" title="Email">‚úâÔ∏è</span><span>{{ profile_user.email or '–Ω–µ —É–∫–∞–∑–∞–Ω–æ' }}</span></div>
          <div class="profile-item"><span class="profile-icon" title="–¢–µ–ª–µ—Ñ–æ–Ω">üìû</span><span>{{ profile_user.phone or '–Ω–µ —É–∫–∞–∑–∞–Ω' }}</span></div>
          <div class="profile-item"><span class="profile-icon" title="–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è">üéÇ</span><span>{{ profile_user.birthday.strftime('%d.%m.%Y') if profile_user.birthday else '–Ω–µ —É–∫–∞–∑–∞–Ω–æ' }}</span></div>
          <div class="profile-item"><span class="profile-icon" title="–Ø–∑—ã–∫">üåê</span><span>{{ profile_user.language or '–Ω–µ —É–∫–∞–∑–∞–Ω' }}</span></div>
          <div class="profile-item"><span class="profile-icon" title="–†–æ–ª—å">üé≠</span>
            <button type="button" class="role-badge" data-role="{{ profile_user.role }}">{{ profile_user.role }}</button>
          </div>
        </div>
        <div style="text-align:right;margin-top:12px;">
          <a class="button" href="/profile/{{ profile_user.username }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
        </div>
      </section>

      {# ‚Äî –¢–∞–π–º–ª–∞–π–Ω –¥–Ω—è #}
      {% set events = day_timeline or [] %}
      <section class="card span-2">
        <div class="card-title">–°–µ–≥–æ–¥–Ω—è</div>
        <div class="timeline">
          {% for event in events %}
          <div class="timeline-row">
            <div class="time">{{ event.time }}</div>
            <div class="dot"></div>
            <div class="text">{{ event.text }}</div>
          </div>
          {% else %}
          <div class="text-muted">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</div>
          {% endfor %}
        </div>
      </section>

      {# ‚Äî KPI —Ä—è–¥: –ø—Ä–∏–º–µ—Ä—ã (–º–æ–≥—É—Ç –ø—Ä–∏–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞) #}
      {% set delta = kpi_focus_week_delta or 0 %}
      <section class="card">
        <div class="card-title">–§–æ–∫—É—Å –∑–∞ –Ω–µ–¥–µ–ª—é</div>
        <div class="kpi">
          <div>
            <div class="label text-muted">–ß–∞—Å—ã</div>
            <div class="value">{{ kpi_focus_week or "0—á" }}</div>
          </div>
          {% if delta is defined %}
          <div class="delta {% if delta >= 0 %}up{% else %}down{% endif %}">
            {{ delta|round(2) }}%
          </div>
          {% endif %}
        </div>
      </section>

      {% set delta = kpi_goals_delta or 0 %}
      <section class="card">
        <div class="card-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
        <div class="kpi">
          <div>
            <div class="label text-muted">–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ü–µ–ª–µ–π</div>
            <div class="value">{{ kpi_goals or "0" }}</div>
          </div>
          {% if delta is defined %}
          <div class="delta {% if delta >= 0 %}up{% else %}down{% endif %}">
            {{ delta|round(2) }}%
          </div>
          {% endif %}
        </div>
      </section>

      {% set delta = kpi_focused_hours_delta or 0 %}
      <section class="card">
        <div class="card-title">–°—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—ã</div>
        <div class="kpi">
          <div>
            <div class="label text-muted">–í—Å–µ–≥–æ</div>
            <div class="value">{{ kpi_focused_hours or "0—á" }}</div>
          </div>
          {% if delta is defined %}
          <div class="delta {% if delta >= 0 %}up{% else %}down{% endif %}">
            {{ delta|round(2) }}%
          </div>
          {% endif %}
        </div>
      </section>

      {% set delta = kpi_health_delta or 0 %}
      <section class="card">
        <div class="card-title">–ó–¥–æ—Ä–æ–≤—å–µ</div>
        <div class="kpi">
          <div>
            <div class="label text-muted">Health score</div>
            <div class="value">{{ kpi_health or "‚Äî" }}</div>
          </div>
          {% if delta is defined %}
          <div class="delta {% if delta >= 0 %}up{% else %}down{% endif %}">
            {{ delta|round(2) }}%
          </div>
          {% endif %}
        </div>
      </section>

      {# ‚Äî –ì—Ä–∞—Ñ–∏–∫–∏/–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã #}
      <section class="card span-2">
        <div class="card-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</div>
        <div class="chart-placeholder"></div>
      </section>
      <section class="card span-2">
        <div class="card-title">–°–æ–Ω / —ç–Ω–µ—Ä–≥–∏—è</div>
        <div class="chart-placeholder"></div>
      </section>

      {# ‚Äî –ì—Ä—É–ø–ø—ã –∏ –ø—Ä–æ–µ–∫—Ç—ã #}
      {% set groups_owned = owned_groups|map(attribute='title')|list %}
      {% set groups_items = groups_owned|map('string')|list %}
      {% set items = owned_groups or [] %}
      <section class="card">
        <div class="card-title">–†—É–∫–æ–≤–æ–¥–∏—Ç–µ –≥—Ä—É–ø–ø–∞–º–∏</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>
          {% endfor %}
        </div>
      </section>

      {% set items = member_groups or [] %}
      <section class="card">
        <div class="card-title">–°–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥—Ä—É–ø–ø–∞—Ö</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>
          {% endfor %}
        </div>
      </section>

      {% set items = owned_projects or [] %}
      <section class="card">
        <div class="card-title">–í–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>
          {% endfor %}
        </div>
      </section>

      {% set items = member_projects or [] %}
      <section class="card">
        <div class="card-title">–£—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>
          {% endfor %}
        </div>
      </section>

      {# ‚Äî –í–∏–¥–∂–µ—Ç—ã —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ #}
      {% set items = upcoming_tasks or [] %}
      <section class="card">
        <div class="card-title">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞–¥–∞—á–∏</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ù–µ—Ç –∑–∞–¥–∞—á</div>
          {% endfor %}
        </div>
      </section>

      {% set items = upcoming_reminders or [] %}
      <section class="card">
        <div class="card-title">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ù–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
          {% endfor %}
        </div>
      </section>

      {% set items = upcoming_events or [] %}
      <section class="card">
        <div class="card-title">–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</div>
          {% endfor %}
        </div>
      </section>

      {% set items = habit_list or [] %}
      <section class="card">
        <div class="card-title">–ü—Ä–∏–≤—ã—á–∫–∏</div>
        <div class="list">
          {% for item in items %}
          <div class="list-item">
            <div class="title">{{ item.title }}</div>
            {% if item.subtitle %}<div class="subtitle text-muted">{{ item.subtitle }}</div>{% endif %}
          </div>
          {% else %}
          <div class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
          {% endfor %}
        </div>
      </section>

    </div>
  </div>
{% endblock %}

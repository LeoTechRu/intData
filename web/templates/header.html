{% set header_user = current_user if (current_user is defined and current_user) else (user if user is defined else None) %}

{#
  Минималистичный хедер: слева логотип, по центру — название модуля,
  справа — иконка профиля с подменю. Лишние элементы (бот, таймер) удалены.
#}

<div class="top-left">
  <a href="/" class="brand-box" aria-label="{{ APP_BRAND_NAME }}">
    <img src="{{ url_for('static', path='img/brand/leonidpro-mark.svg') }}" alt="" />
  </a>
  {# Текстовый бренд убран по требованию — оставляем только знак #}
</div>

<div class="top-center">
  {% set TITLE_TEXT = (MODULE_TITLE if MODULE_TITLE is defined and MODULE_TITLE else APP_BRAND_NAME)|striptags %}
  <h1 class="page-title">{{ TITLE_TEXT }}</h1>
  <button id="favToggle" class="fav-toggle" type="button" data-path="{{ request.url.path }}" data-label="{{ TITLE_TEXT }}" aria-label="Добавить в избранное">☆</button>
  {# На узких экранах .top-center скрывается через CSS #}
</div>

<div class="top-right">
  <div class="profile-wrap">
    <button class="avatar-btn" id="profileBtn" aria-controls="profileMenu" aria-haspopup="menu" aria-expanded="false">
      <img class="avatar" src="{{ header_user.avatar_url | default(url_for('static', path='img/profile-default.svg'), true) }}" alt="" />
    </button>
    <div class="dropdown-menu profile-menu" id="profileMenu" role="menu" aria-hidden="true">
        <ul class="menu-section menu-list">
          <li><a role="menuitem" href="/profile/{{ header_user.username if header_user else '' }}">Профиль</a></li>
          <li><a role="menuitem" href="/settings">Настройки</a></li>
        </ul>
        <hr class="menu-sep"/>
        <ul class="menu-section menu-list" data-fav-box aria-label="Избранное"></ul>
        <hr class="menu-sep"/>
        <ul class="menu-section menu-list">
          <li><a role="menuitem" href="/auth/logout" data-method="post">Выход</a></li>
        </ul>
    </div>
  </div>
</div>

(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[893],{397:(e,r,t)=>{"use strict";t.d(r,{default:()=>u});var a=t(5155),s=t(2115),l=t(2454),i=t(549),n=t(8185),c=t(7621),d=t(4635),o=t(6816);function u(){var e,r,t,u,m,x;let p=(0,l.I)({queryKey:["areas"],staleTime:6e4,gcTime:3e5,queryFn:()=>(0,c.nr)("/api/v1/areas")}),f=(0,l.I)({queryKey:["projects",null,null!=(x=null==m?void 0:m.includeSub)&&x],staleTime:3e4,gcTime:3e5,queryFn:()=>{let e=new URLSearchParams;(null==m?void 0:m.areaId)&&(e.set("area_id",String(m.areaId)),m.includeSub&&e.set("include_sub","1"));let r=e.toString();return(0,c.nr)("/api/v1/projects".concat(r?"?".concat(r):""))}}),[b,v]=(0,s.useState)({name:"",areaId:"",slug:"",description:""}),[h,g]=(0,s.useState)(null),j=null!=(t=p.error)?t:f.error,y=j?j instanceof c.hD?j.message:"Не удалось загрузить данные":null,N=(0,s.useMemo)(()=>{var e;return(0,d.G)(null!=(e=p.data)?e:[])},[p.data]),w=(0,s.useMemo)(()=>{var e;let r=new Map;return(null!=(e=p.data)?e:[]).forEach(e=>r.set(e.id,e)),r},[p.data]),S=(0,i.n)({mutationFn:async e=>(0,c.nr)("/api/v1/projects",{method:"POST",body:JSON.stringify(e)}),onSuccess:()=>{v({name:"",areaId:"",slug:"",description:""}),g(null),f.refetch()},onError:e=>{if(e instanceof c.hD){let r="object"==typeof e.info&&null!==e.info?e.info.detail:null;g(null!=r?r:e.message);return}g("Не удалось создать проект")}}),_=f.isLoading||p.isLoading,I=(null!=(u=null==(e=f.data)?void 0:e.length)?u:0)>0;return(0,a.jsxs)(n.A,{title:"Проекты",description:"Управляйте проектами, привязывайте их к областям и отслеживайте структуру PARA.",children:[(0,a.jsxs)(o.Zp,{surface:"soft",children:[(0,a.jsxs)("form",{className:"flex flex-col gap-6",onSubmit:e=>{if(e.preventDefault(),!b.name.trim()||!b.areaId)return void g("Укажите название и область");let r={name:b.name.trim(),area_id:Number(b.areaId),description:b.description.trim()?b.description.trim():null,slug:b.slug.trim()?b.slug.trim():null};S.mutate(r)},children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsx)(o.D0,{label:"Название проекта",required:!0,htmlFor:"project-name",children:(0,a.jsx)(o.pd,{id:"project-name",name:"name",value:b.name,onChange:e=>v(r=>({...r,name:e.target.value})),placeholder:"Новый проект",required:!0})}),(0,a.jsx)(o.D0,{label:"Область (Area)",required:!0,htmlFor:"project-area",children:(0,a.jsxs)(o.l6,{id:"project-area",name:"area",value:b.areaId,onChange:e=>v(r=>({...r,areaId:e.target.value})),required:!0,disabled:p.isLoading,children:[(0,a.jsx)("option",{value:"",children:"— выберите область —"}),N.map(e=>(0,a.jsx)("option",{value:e.id,disabled:!e.isLeaf,children:e.label},e.id))]})}),(0,a.jsx)(o.D0,{label:"Слаг (опционально)",htmlFor:"project-slug",children:(0,a.jsx)(o.pd,{id:"project-slug",name:"slug",value:b.slug,onChange:e=>v(r=>({...r,slug:e.target.value})),placeholder:"project-alpha"})}),(0,a.jsx)(o.D0,{label:"Описание (опционально)",htmlFor:"project-description",children:(0,a.jsx)(o.TM,{id:"project-description",name:"description",value:b.description,onChange:e=>v(r=>({...r,description:e.target.value})),rows:3,placeholder:"Краткое описание для команды",className:"min-h-[96px]"})})]}),h?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",role:"alert",children:h}):null,(0,a.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,a.jsx)(o.$n,{type:"submit",disabled:S.isPending,children:S.isPending?"Сохраняем…":"Добавить проект"})})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-muted",children:"Выбирайте листья дерева Areas: родительские узлы недоступны для привязки проектов."})]}),y?(0,a.jsxs)(o.Zp,{className:"border-red-200/80 bg-red-50 text-sm text-red-700",children:[(0,a.jsx)("strong",{className:"font-semibold",children:y}),(0,a.jsx)("span",{className:"mt-1 text-xs text-red-600/80",children:"Попробуйте обновить страницу или проверьте соединение с сервером."})]}):null,(0,a.jsx)(o.Zp,{padded:!1,className:"overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full table-fixed border-collapse text-sm",children:[(0,a.jsx)("thead",{className:"bg-surface-soft text-left text-xs uppercase tracking-wide text-muted",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-5 py-3 font-medium",children:"ID"}),(0,a.jsx)("th",{className:"px-5 py-3 font-medium",children:"Название"}),(0,a.jsx)("th",{className:"px-5 py-3 font-medium",children:"Area"}),(0,a.jsx)("th",{className:"px-5 py-3 font-medium",children:"Slug"})]})}),(0,a.jsx)("tbody",{children:_?Array.from({length:3}).map((e,r)=>(0,a.jsxs)("tr",{className:"animate-pulse border-t border-subtle-soft",children:[(0,a.jsx)("td",{className:"px-5 py-3",children:(0,a.jsx)("div",{className:"h-3 w-12 rounded-full bg-surface-soft"})}),(0,a.jsx)("td",{className:"px-5 py-3",children:(0,a.jsx)("div",{className:"h-3 w-32 rounded-full bg-surface-soft"})}),(0,a.jsx)("td",{className:"px-5 py-3",children:(0,a.jsx)("div",{className:"h-3 w-24 rounded-full bg-surface-soft"})}),(0,a.jsx)("td",{className:"px-5 py-3",children:(0,a.jsx)("div",{className:"h-3 w-20 rounded-full bg-surface-soft"})})]},"loading-".concat(r))):I?null==(r=f.data)?void 0:r.map(e=>{var r;let t=w.get(e.area_id);return(0,a.jsxs)("tr",{className:"border-t border-subtle",children:[(0,a.jsxs)("td",{className:"px-5 py-3 font-mono text-xs text-muted",children:["#",e.id]}),(0,a.jsx)("td",{className:"px-5 py-3 font-medium text-[var(--text-primary)]",children:e.name}),(0,a.jsx)("td",{className:"px-5 py-3 text-sm text-[var(--text-primary)]",children:t?t.name:"Area #".concat(e.area_id)}),(0,a.jsx)("td",{className:"px-5 py-3 text-sm text-muted",children:null!=(r=e.slug)?r:"—"})]},e.id)}):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"px-6 py-8 text-center text-sm text-muted",children:"Пока нет проектов — добавьте первый, чтобы связать задачи и материалы."})})})]})})})]})}},526:(e,r,t)=>{"use strict";t.d(r,{cn:()=>l});var a=t(2821),s=t(5889);function l(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,a.$)(r))}},4186:(e,r,t)=>{Promise.resolve().then(t.bind(t,397))},4635:(e,r,t)=>{"use strict";function a(e){let r=[...e].sort((e,r)=>{var t,a;let s=null!=(t=e.mp_path)?t:"",l=null!=(a=r.mp_path)?a:"";return s===l?e.name.localeCompare(r.name):s.localeCompare(l)}),t=new Set;for(let r of e)null!==r.parent_id&&void 0!==r.parent_id&&t.add(r.parent_id);return r.map(e=>{var r;let a=null!=(r=e.depth)?r:0,s=a>0?"".concat("— ".repeat(a)):"";return{id:e.id,label:"".concat(s).concat(e.name),depth:a,isLeaf:!t.has(e.id),color:e.color}})}t.d(r,{G:()=>a})},6128:(e,r,t)=>{"use strict";t.d(r,{w:()=>i});var a=t(5155);t(2115);var s=t(526);let l={none:"gap-0",sm:"gap-3",md:"gap-4",lg:"gap-6"};function i(e){let{spacing:r="md",className:t,children:i,...n}=e;return(0,a.jsx)("section",{className:(0,s.cn)("flex flex-col",l[r],t),...n,children:i})}},6816:(e,r,t)=>{"use strict";t.d(r,{Ex:()=>i,$n:()=>d,Zp:()=>o,Sc:()=>u,pp:()=>m,D0:()=>x,pd:()=>p,l6:()=>f,TM:()=>b,M7:()=>v});var a=t(5155),s=t(2115),l=t(526);function i(e){let{tone:r="accent",size:t="md",uppercase:s=!0,className:i,children:n,...c}=e;return(0,a.jsx)("span",{className:(0,l.cn)("inline-flex items-center rounded-full font-medium tracking-wide",s&&"uppercase","accent"===r?"bg-[var(--accent-primary-soft)] text-[var(--text-primary)]":"success"===r?"bg-emerald-100 text-emerald-700":"warning"===r?"bg-amber-100 text-amber-700":"bg-surface-soft text-muted","sm"===t?"px-2 py-0.5 text-[0.65rem]":"px-3 py-1 text-xs",i),...c,children:n})}let n={primary:"bg-[var(--accent-primary)] text-[var(--accent-on-primary)] focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-[var(--surface-0)] hover:opacity-90",secondary:"bg-surface-soft text-[var(--text-primary)] border border-subtle focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-[var(--surface-0)] hover:bg-[var(--surface-0)]",ghost:"bg-transparent text-[var(--text-primary)] hover:bg-surface-soft focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-[var(--surface-0)]",outline:"border border-subtle text-[var(--text-primary)] hover:border-[var(--accent-primary)] hover:text-[var(--accent-primary)] focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-[var(--surface-0)]",subtle:"bg-[color-mix(in srgb, var(--accent-primary) 8%, transparent)] text-[var(--text-primary)] hover:bg-[color-mix(in srgb, var(--accent-primary) 12%, transparent)] focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-[var(--surface-0)]",danger:"bg-red-500 text-white hover:bg-red-600 focus-visible:ring-red-500 focus-visible:ring-offset-[var(--surface-0)]"},c={sm:"h-9 px-3 text-xs",md:"h-10 px-4",lg:"h-11 px-5 text-base",icon:"h-10 w-10 text-base"},d=(0,s.forwardRef)((e,r)=>{let{variant:t="primary",size:s="md",fullWidth:i=!1,className:d,type:o="button",...u}=e;return(0,a.jsx)("button",{ref:r,type:o,className:(0,l.cn)("inline-flex items-center justify-center gap-2 rounded-xl text-sm font-medium transition-base focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-60",n[t],c[s],i&&"w-full",d),...u})});d.displayName="Button";let o=(0,s.forwardRef)((e,r)=>{let{className:t,padded:s=!0,surface:i="default",as:n="section",...c}=e;return(0,a.jsx)(n,{ref:r,className:(0,l.cn)("rounded-2xl border border-subtle shadow-soft","soft"===i?"bg-surface-soft":"bg-[var(--surface-0)]",s&&"p-6",t),...c})});o.displayName="Card";let u=(0,s.forwardRef)((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("input",{ref:r,type:"checkbox",className:(0,l.cn)("h-4 w-4 rounded border-subtle text-[var(--accent-primary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--surface-0)]",t),...s})});function m(e){let{title:r,description:t,action:s,icon:i,className:n,...c}=e;return(0,a.jsxs)(o,{as:"article",padded:!0,surface:"soft",className:(0,l.cn)("flex flex-col items-start gap-3 text-sm text-muted",n),...c,children:[i?(0,a.jsx)("div",{className:"text-2xl","aria-hidden":!0,children:i}):null,(0,a.jsx)("div",{className:"text-base font-semibold text-[var(--text-primary)]",children:r}),t?(0,a.jsx)("p",{children:t}):null,s?(0,a.jsx)("div",{className:"mt-2",children:s}):null]})}function x(e){let{label:r,description:t,error:i,inline:n=!1,required:c=!1,htmlFor:d,className:o,children:u,...m}=e,x=(0,s.useId)(),p=null!=d?d:x,f="".concat(p,"-label"),b=s.Children.map(u,e=>{if(!(0,s.isValidElement)(e))return e;let t={};e.props.id||(t.id=p);let a=e.props["aria-labelledby"];return t["aria-labelledby"]=a?"".concat(a," ").concat(f):f,"string"!=typeof r||e.props["aria-label"]||(t["aria-label"]=r),(0,s.cloneElement)(e,t)});return(0,a.jsxs)("div",{className:(0,l.cn)("flex flex-col gap-2 text-sm text-muted",n?"md:flex-row md:items-center md:gap-4":null,o),...m,children:[(0,a.jsxs)("label",{id:f,htmlFor:null!=d?d:p,className:"flex items-center gap-1 text-sm font-medium text-[var(--text-primary)]",children:[(0,a.jsx)("span",{children:r}),c?(0,a.jsx)("span",{className:"text-red-500","aria-hidden":"true",children:"*"}):null]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[b,t?(0,a.jsx)("p",{className:"text-xs text-muted",children:t}):null,i?(0,a.jsx)("p",{className:"text-xs text-red-600",children:i}):null]})]})}u.displayName="Checkbox";let p=(0,s.forwardRef)((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("input",{ref:r,className:(0,l.cn)("w-full rounded-xl border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] transition-base placeholder:text-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",t),...s})});p.displayName="Input";let f=(0,s.forwardRef)((e,r)=>{let{className:t,children:s,...i}=e;return(0,a.jsx)("select",{ref:r,className:(0,l.cn)("w-full rounded-xl border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] transition-base focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",t),...i,children:s})});f.displayName="Select",t(6128);let b=(0,s.forwardRef)((e,r)=>{let{className:t,rows:s=3,...i}=e;return(0,a.jsx)("textarea",{ref:r,rows:s,className:(0,l.cn)("w-full rounded-xl border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] transition-base placeholder:text-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",t),...i})});function v(e){let{justify:r="between",className:t,children:s,...i}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-wrap items-center gap-3 rounded-2xl border border-subtle bg-surface-soft px-4 py-3","start"===r?"justify-start":"end"===r?"justify-end":"justify-between",t),...i,children:s})}b.displayName="Textarea"},8185:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var a=t(5155);t(2115);var s=t(2235),l=t(526),i=t(6128);function n(e){let{title:r,subtitle:t,description:n,actions:c,contentClassName:d,children:o}=e;return(0,a.jsx)(s.default,{title:r,subtitle:t,actions:c,children:(0,a.jsxs)(i.w,{className:(0,l.cn)("p-6 md:p-8",d),spacing:"lg","aria-labelledby":"page-title","data-testid":"page-layout",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h1",{id:"page-title",className:"text-xl font-semibold tracking-tight text-[var(--text-primary)]","data-testid":"page-title",children:r}),n?(0,a.jsx)("p",{className:"text-sm text-muted",children:n}):null]}),o]})})}}},e=>{e.O(0,[652,743,454,889,195,441,255,358],()=>e(e.s=4186)),_N_E=e.O()}]);
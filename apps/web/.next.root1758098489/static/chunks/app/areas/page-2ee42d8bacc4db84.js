(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[955],{526:(e,r,t)=>{"use strict";t.d(r,{cn:()=>s});var a=t(2821),l=t(5889);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,l.QP)((0,a.$)(r))}},4635:(e,r,t)=>{"use strict";function a(e){let r=[...e].sort((e,r)=>{var t,a;let l=null!=(t=e.mp_path)?t:"",s=null!=(a=r.mp_path)?a:"";return l===s?e.name.localeCompare(r.name):l.localeCompare(s)}),t=new Set;for(let r of e)null!==r.parent_id&&void 0!==r.parent_id&&t.add(r.parent_id);return r.map(e=>{var r;let a=null!=(r=e.depth)?r:0,l=a>0?"".concat("— ".repeat(a)):"";return{id:e.id,label:"".concat(l).concat(e.name),depth:a,isLeaf:!t.has(e.id),color:e.color}})}t.d(r,{G:()=>a})},5079:(e,r,t)=>{Promise.resolve().then(t.bind(t,6127))},6127:(e,r,t)=>{"use strict";t.d(r,{default:()=>d});var a=t(5155),l=t(2115),s=t(2454),n=t(549),i=t(8185),o=t(7621),c=t(4635);function d(){let e=(0,s.I)({queryKey:["areas"],staleTime:6e4,gcTime:3e5,queryFn:()=>(0,o.nr)("/api/v1/areas")}),[r,t]=(0,l.useState)(null),[d,u]=(0,l.useState)({name:"",parentId:"",color:"#F1F5F9"}),[m,x]=(0,l.useState)({rename:"",parentId:""}),[p,f]=(0,l.useState)(null),[b,v]=(0,l.useState)(null),[g,h]=(0,l.useState)(null),y=(0,l.useMemo)(()=>{var r;return null!=(r=e.data)?r:[]},[e.data]),j=(0,l.useMemo)(()=>[...y].sort((e,r)=>{var t,a;let l=null!=(t=e.mp_path)?t:"",s=null!=(a=r.mp_path)?a:"";return l===s?e.name.localeCompare(r.name):l.localeCompare(s)}),[y]),N=(0,l.useMemo)(()=>(0,c.G)(y),[y]),S=(0,l.useMemo)(()=>{var e;return null!=(e=y.find(e=>e.id===r))?e:null},[y,r]);(0,l.useEffect)(()=>{!r&&j.length>0&&t(j[0].id)},[j,r]),(0,l.useEffect)(()=>{if(!S){x({rename:"",parentId:""}),h(null),v(null);return}x({rename:S.name,parentId:S.parent_id?String(S.parent_id):""}),h(null),v(null)},[S]);let{refetch:_}=e,w=(0,n.n)({mutationFn:async e=>(0,o.nr)("/api/v1/areas",{method:"POST",body:JSON.stringify(e)}),onSuccess:async e=>{f(null),u({name:"",parentId:d.parentId,color:"#F1F5F9"}),t(e.id),await _()},onError:e=>{if(e instanceof o.hD){let r="object"==typeof e.info&&null!==e.info?e.info.detail:null;f(null!=r?r:e.message);return}f("Не удалось создать область")}}),F=(0,n.n)({mutationFn:async e=>{let{areaId:r,newName:t}=e;return(0,o.nr)("/api/v1/areas/".concat(r,"/rename"),{method:"POST",body:JSON.stringify({name:t})})},onSuccess:async()=>{v(null),h("Название обновлено"),await _()},onError:e=>{if(h(null),e instanceof o.hD){let r="object"==typeof e.info&&null!==e.info?e.info.detail:null;v(null!=r?r:e.message);return}v("Не удалось переименовать область")}}),I=(0,n.n)({mutationFn:async e=>{let{areaId:r,newParentId:t}=e;return(0,o.nr)("/api/v1/areas/".concat(r,"/move"),{method:"POST",body:JSON.stringify({new_parent_id:t})})},onSuccess:async()=>{v(null),h("Область перемещена"),await _()},onError:e=>{if(h(null),e instanceof o.hD){let r="object"==typeof e.info&&null!==e.info?e.info.detail:null;v(null!=r?r:e.message);return}v("Не удалось переместить область")}}),C=e.error,P=C?C instanceof o.hD?C.message:"Не удалось загрузить данные":null,k=e.isLoading,E=(0,l.useMemo)(()=>S?N.filter(e=>{let r=y.find(r=>r.id===e.id);return!(!r||r.id===S.id||function(e,r){var t,a;if(e.id===r.id)return!1;let l=null!=(t=e.mp_path)?t:"",s=null!=(a=r.mp_path)?a:"";return!!l&&!!s&&l.startsWith(s)&&l!==s}(r,S))}):N,[N,y,S]);return(0,a.jsx)(i.A,{title:"Области",description:"Структурируйте сферы ответственности, создавайте вложенные области и управляйте деревом PARA.",children:(0,a.jsxs)("section",{className:"grid gap-6 lg:grid-cols-[320px,minmax(0,1fr)]",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"rounded-2xl border border-subtle bg-surface-soft p-5",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted",children:"Дерево областей"}),k?(0,a.jsx)("ul",{className:"mt-4 space-y-2",children:Array.from({length:4}).map((e,r)=>(0,a.jsx)("li",{className:"h-4 w-full animate-pulse rounded-full bg-surface"},r))}):0===j.length?(0,a.jsx)("p",{className:"mt-4 text-sm text-muted",children:"Пока нет областей — создайте первую область для структуры PARA."}):(0,a.jsx)("ul",{className:"mt-4 space-y-1",children:j.map(e=>{var l;let s=null!=(l=e.depth)?l:0,n=e.id===r;return(0,a.jsx)("li",{children:(0,a.jsxs)("button",{type:"button",className:"flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm transition-base focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--surface-0)] ".concat(n?"bg-[var(--accent-primary)] text-[var(--accent-on-primary)] shadow-soft":"text-[var(--text-primary)] hover:bg-[var(--surface-0)]"),style:{paddingLeft:"".concat(12+16*s,"px")},onClick:()=>t(e.id),"data-testid":"area-node-".concat(e.id),children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[e.color?(0,a.jsx)("span",{"aria-hidden":!0,className:"inline-flex h-3 w-3 rounded-full border border-white/40",style:{backgroundColor:e.color}}):null,e.name]}),(0,a.jsxs)("span",{className:"text-xs text-muted",children:["#",e.id]})]})},e.id)})})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-subtle bg-surface-soft p-5",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted",children:"Новая область"}),(0,a.jsxs)("form",{className:"mt-4 flex flex-col gap-4",onSubmit:e=>{var r;if(e.preventDefault(),!d.name.trim())return void f("Введите название области");let t={name:d.name.trim(),color:(null==(r=d.color)?void 0:r.trim())||null,parent_id:d.parentId?Number(d.parentId):null};w.mutate(t)},children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm text-muted",htmlFor:"create-area-name",children:["Название новой области",(0,a.jsx)("input",{id:"create-area-name",type:"text",value:d.name,onChange:e=>u(r=>({...r,name:e.target.value})),placeholder:"Например, Здоровье",className:"rounded-xl border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",required:!0})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm text-muted",htmlFor:"create-area-parent",children:["Родительская область",(0,a.jsxs)("select",{id:"create-area-parent",value:d.parentId,onChange:e=>u(r=>({...r,parentId:e.target.value})),className:"rounded-xl border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",children:[(0,a.jsx)("option",{value:"",children:"— верхний уровень —"}),N.map(e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id))]})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm text-muted",htmlFor:"create-area-color",children:["Цвет (HEX)",(0,a.jsx)("input",{id:"create-area-color",type:"text",value:d.color,onChange:e=>u(r=>({...r,color:e.target.value})),className:"rounded-xl border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",placeholder:"#F1F5F9"})]}),p?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",children:p}):null,(0,a.jsx)("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-[var(--accent-primary)] px-4 py-2 text-sm font-medium text-[var(--accent-on-primary)] transition-base hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--surface-0)] disabled:cursor-progress disabled:opacity-70",disabled:w.isPending,children:w.isPending?"Создаём…":"Добавить область"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[P?(0,a.jsx)("div",{className:"rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-600",children:P}):null,(0,a.jsx)("div",{className:"rounded-2xl border border-subtle bg-[var(--surface-0)] p-6",children:S?(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted",children:"Область"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-[var(--text-primary)]",children:S.name}),(0,a.jsxs)("p",{className:"text-xs text-muted",children:["ID #",S.id," \xb7 slug ",S.slug||"—"]})]}),(0,a.jsxs)("form",{className:"flex flex-col gap-3 rounded-xl border border-subtle bg-surface-soft p-4",onSubmit:e=>{if(e.preventDefault(),S){if(!m.rename.trim())return void v("Название не может быть пустым");F.mutate({areaId:S.id,newName:m.rename.trim()})}},children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-[var(--text-primary)]",children:"Переименовать"}),(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm text-muted",htmlFor:"rename-area-name",children:["Новое название",(0,a.jsx)("input",{id:"rename-area-name",type:"text",value:m.rename,onChange:e=>x(r=>({...r,rename:e.target.value})),className:"rounded-lg border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",required:!0})]}),(0,a.jsx)("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 rounded-lg bg-[var(--accent-primary)] px-4 py-2 text-sm font-medium text-[var(--accent-on-primary)] transition-base hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--surface-0)] disabled:cursor-progress disabled:opacity-70",disabled:F.isPending,children:F.isPending?"Сохраняем…":"Сохранить"})]}),(0,a.jsxs)("form",{className:"flex flex-col gap-3 rounded-xl border border-subtle bg-surface-soft p-4",onSubmit:e=>{if(e.preventDefault(),!S)return;let r=m.parentId?Number(m.parentId):null;I.mutate({areaId:S.id,newParentId:r})},children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-[var(--text-primary)]",children:"Переместить"}),(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm text-muted",htmlFor:"move-area-parent",children:["Переместить в",(0,a.jsxs)("select",{id:"move-area-parent",value:m.parentId,onChange:e=>x(r=>({...r,parentId:e.target.value})),className:"rounded-lg border border-subtle bg-[var(--surface-0)] px-3 py-2 text-base text-[var(--text-primary)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)]",children:[(0,a.jsx)("option",{value:"",children:"— верхний уровень —"}),E.map(e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id))]})]}),(0,a.jsx)("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 rounded-lg bg-[var(--accent-primary)] px-4 py-2 text-sm font-medium text-[var(--accent-on-primary)] transition-base hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-primary)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--surface-0)] disabled:cursor-progress disabled:opacity-70",disabled:I.isPending,children:I.isPending?"Перемещаем…":"Переместить"})]}),b?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",children:b}):null,g?(0,a.jsx)("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:g}):null]}):(0,a.jsx)("p",{className:"text-sm text-muted",children:"Выберите область в списке слева, чтобы увидеть подробности."})})]})]})})}},6128:(e,r,t)=>{"use strict";t.d(r,{w:()=>n});var a=t(5155);t(2115);var l=t(526);let s={none:"gap-0",sm:"gap-3",md:"gap-4",lg:"gap-6"};function n(e){let{spacing:r="md",className:t,children:n,...i}=e;return(0,a.jsx)("section",{className:(0,l.cn)("flex flex-col",s[r],t),...i,children:n})}},8185:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var a=t(5155);t(2115);var l=t(2235),s=t(526),n=t(6128);function i(e){let{title:r,subtitle:t,description:i,actions:o,contentClassName:c,children:d}=e;return(0,a.jsx)(l.default,{title:r,subtitle:t,actions:o,children:(0,a.jsxs)(n.w,{className:(0,s.cn)("p-6 md:p-8",c),spacing:"lg","aria-labelledby":"page-title","data-testid":"page-layout",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h1",{id:"page-title",className:"text-xl font-semibold tracking-tight text-[var(--text-primary)]","data-testid":"page-title",children:r}),i?(0,a.jsx)("p",{className:"text-sm text-muted",children:i}):null]}),d]})})}}},e=>{e.O(0,[652,743,454,889,195,441,255,358],()=>e(e.s=5079)),_N_E=e.O()}]);
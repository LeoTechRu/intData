# ADR: Collapsible быстрые заметки и фильтры (2025-09-24)

## Контекст
- Страница `/notes` одновременно рендерит форму создания заметки и панель фильтров, что раздувает первый экран и перегружает пользователей.
- Текущее состояние `quickNote` и `filtersDraft` хранится в компоненте `NotesModule`; формы открыты всегда, даже когда пользователь не взаимодействует с ними.
- Владельцу нужен интерфейс «аккордеон»: компактная строка с CTA, которая раскрывает полную форму по клику/фокусу и сворачивается обратно.

## Решение
1. **Новый UI-компонент `CollapsibleSection`**
   - Расположим в `web/components/ui/CollapsibleSection.tsx` с пропсами `title`, `open`, `onToggle`, `children`, `subtitle?`, `icon?`.
   - Используем Tailwind классы `transition-all`, `max-h`, `aria-expanded` для доступности; высоту раскрытой секции ограничиваем `max-h-[1000px]` и `overflow-hidden`.
   - Добавим Chevron-иконку из уже подключённых heroicons (`ChevronDownIcon`).

2. **Паттерн управления состоянием**
   - В `NotesModule` заводим `isQuickOpen` и `isFilterOpen`, управляем кликом по шапке и фокусом основных полей (content/search).
   - Для UX: при фокусе контента (textarea) автоматически открываем секцию, при отправке/сбросе — сворачиваем.
   - Секции должны помнить своё состояние при навигации: используем `useState` без синхронизации с query params.

3. **Форма быстрой заметки**
   - В свернутом виде показываем placeholder «Новая заметка…» (button-like). При клике открываем форму.
   - В раскрытом состоянии отображаем поля title/content/selects; первичный CTA — `Сохранить заметку`.
   - Ошибки и disable пока оставляем как есть, но отображаем внутри секции.

4. **Фильтры**
   - Заголовок секции показывает текущий контекст: «Фильтры: Все области, Все проекты» + бейджи «Закреплённые», «Архив» при активных флагах.
   - Тело содержит прежнюю форму и кнопку «Применить».

5. **Адаптивность**
   - Контейнеры секций занимают всю ширину; на десктопе формы сохраняют двухколоночную сетку.
   - Для мобильных убираем лишние отступы (`px-4`, `py-3`), чтобы свернутая полоса помещалась в viewport.

6. **Тесты**
   - Обновим `NotesModule.test.tsx`: добавить сценарии «форма скрыта при рендере», «раскрытие по клику», «отправка формы сворачивает секцию».

## Альтернативы
- Tailwind `details/summary` — отклонено: ограниченный контроль стилизации и анимации.
- Использовать готовый `Disclosure` из Headless UI — лишняя зависимость, можно реализовать проще.

## Риски
- Высота по `max-h` может отсекать высокое содержимое; mitigations: ставим большой лимит и следим за overflow.
- При скрытии формы важно не терять фокус на мобильных: переключение будем делать после `setState` + `requestAnimationFrame`, если потребуется (в текущем MVP допустимо без доп. логики).

## Follow-ups
- Переиспользовать `CollapsibleSection` для проектов/задач (отдельный backlog).
- Подготовить Storybook кейсы для компонента.
